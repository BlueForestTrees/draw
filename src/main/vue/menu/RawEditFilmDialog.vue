<template>
    <v-dialog
            v-model="nav.filmDialogVisible"
            fullscreen
            transition="dialog-bottom-transition"
            :overlay="false"
            scrollable
    >
        <v-card tile>
            <v-toolbar card dark color="primary">
                <v-btn dark flat @click.native="importFilm">Import</v-btn>
                <v-btn dark flat @click.native="exportFilm">Export</v-btn>
                <v-toolbar-title>Raw Edit Film</v-toolbar-title>
                <v-spacer></v-spacer>
                <v-toolbar-items>
                    <v-btn icon @click.native="nav.filmDialogVisible = false" dark>
                        <v-icon>close</v-icon>
                    </v-btn>
                </v-toolbar-items>
            </v-toolbar>
            <v-card-text>
                <v-text-field auto-grow multi-line v-model="rawFilm" :value="rawFilm"/>
            </v-card-text>

            <div style="flex: 1 1 auto;"></div>
        </v-card>
    </v-dialog>
</template>
<script>
    import {mapActions, mapState} from "vuex";
    import On from "../../const/on";

    export default {
        name: "film-dialog",
        props: ['film'],
        computed: {
            ...mapState(['nav'])
        },
        methods: {
            ...mapActions({dispatchUpdateFilm: On.UPDATE_FILM}),
            importFilm: function () {
                try {
                    this.dispatchUpdateFilm(this.rawFilm);
                    this.nav.filmDialogVisible = false;
                } catch (e) {
                    console.error(e);
                }
            },
            exportFilm: function () {
                this.rawFilm = JSON.stringify(this.film, null, 4);
            }
        },
        data:
            function () {
                return {
                    rawFilm: "{\n" +
                    "    \"f\": {\n" +
                    "        \"name\": \"film #0a667\",\n" +
                    "        \"elements\": [],\n" +
                    "        \"masks\": [\n" +
                    "            {\n" +
                    "                \"e\": {\n" +
                    "                    \"_id\": \"0.9109941970958337\",\n" +
                    "                    \"pen\": {\n" +
                    "                        \"_id\": \"0.8767734543163963\",\n" +
                    "                        \"color\": \"#000000\",\n" +
                    "                        \"width\": 10,\n" +
                    "                        \"opacity\": 1,\n" +
                    "                        \"mask\": false,\n" +
                    "                        \"stroke\": false,\n" +
                    "                        \"linecap\": \"butt\"\n" +
                    "                    },\n" +
                    "                    \"points\": null,\n" +
                    "                    \"d\": \"M87.7,75.37c4.36,3,9.21,5.55,13.09,9.14,10.32,9.54,13.11,22,12.38,35.52-.53,9.89-2.94,19.27-9.52,27.08-8.23,9.78-19.32,14.26-31.49,16.54-20,3.74-40,3-60.07.89-3-.32-5.94-.73-8.93-.92-2.16-.14-3.26-1-3.09-3.25,0-.5,0-1,0-1.5Q.09,83.13,0,7.38C0,3.7,1.29,2.91,4.65,2.47,20.17.44,35.74-.61,51.36.38c13,.83,25.87,2.84,36.81,10.86,9.1,6.67,13.75,15.74,14.65,27,.95,11.78-1.67,22.3-9.6,31.27C91.42,71.56,89.48,73.49,87.7,75.37ZM38.37,115c0,5.49,0,11,0,16.47,0,1.92.49,3.24,2.67,3.12,6.07-.34,12.27-.08,18.18-1.26,8.88-1.76,14.24-8.36,14.33-17.24.12-10.65-3.49-15.4-11.9-18.57-7-2.63-14.24-2.11-21.45-1.88-.63,0-1.7,1.86-1.73,2.88C38.28,104,38.37,109.47,38.37,115Zm0-68c0,4.75.05,9.5,0,14.24,0,1.86.53,2.92,2.54,2.72,4.56-.46,9.17-.63,13.66-1.49A12.65,12.65,0,0,0,65.1,51.61c1.16-6.58.84-13-5.36-17.54-6-4.42-12.9-4.06-19.76-3.72-.58,0-1.5,1.77-1.53,2.74C38.29,37.72,38.38,42.35,38.37,47Z M293.2,47.44A116.77,116.77,0,0,1,328.69,47c2.46.31,2.18,1.93,2.18,3.54q0,12.37,0,24.73c0,26.23,0,52.47.06,78.7,0,3.26-.89,4.86-4.19,5.81-21.52,6.2-43.21,8.79-65.39,4-16.6-3.56-26.89-13.8-30.75-30.05a102.16,102.16,0,0,1-2.36-21.87c-.31-20,0-40-.2-60,0-3.76,1.11-5.22,4.73-5.19q14.74.13,29.49.14c3.08,0,3.89,1.43,3.87,4.41q-.18,30.73,0,61.46a41.37,41.37,0,0,0,1.25,9.58c1.76,7.15,7,10.27,13.92,11,11.93,1.17,11.93,1.14,11.93-10.56q0-35.6,0-71.2Z M389.27,117.71A18.11,18.11,0,0,0,402,133.09c7.22,2.3,14.59,2.15,21.87.86,6.11-1.08,12-3.11,18.11-4.46a4,4,0,0,1,3.44,1.39c3.91,6.52,6.77,19.47,6.39,28.57-6.12,1.54-12.42,3.39-18.83,4.69-13.48,2.74-27.08,3.2-40.53.13-21.4-4.88-34.88-18.07-39.56-39.67C349,106.78,350,89.24,358.4,72.79,366.24,57.5,379,48.57,396,45.6c12.41-2.17,24.42-1.49,35.79,4.18,14.91,7.45,22.55,20.19,25.65,36.13,1.88,9.7,1.12,19.36,0,29.07-.35,3.06-2.32,2.73-4.3,2.73H389.27Zm35.3-26.33A19.5,19.5,0,0,0,420,78.79c-4.76-5.56-11-6.67-17.74-5.08-7.35,1.74-11.7,6.61-13.52,14-.74,3-.2,4.1,3,4.06,9.87-.13,19.75,0,29.62-.06C422.36,91.69,423.32,91.51,424.57,91.37Z M133.22,163.56c0-1.56,0-2.77,0-4,.09-36,.25-71.95.19-107.92,0-3.61,1.18-4.94,4.56-4.93,9.71,0,19.41.07,29.12,0,3.36,0,4,1.65,4,4.7-.11,25.23-.06,50.47-.06,75.71,0,4.91,0,4.91,4.94,4.91,11.49,0,23,.07,34.48-.06,2.32,0,3.61.56,3.6,3q0,13-.15,26.07c0,2.1-1.2,2.56-3.19,2.55C185.06,163.54,159.46,163.56,133.22,163.56Z\"\n" +
                    "                },\n" +
                    "                \"_id\": \"0.9038287989258866\",\n" +
                    "                \"tx\": 12,\n" +
                    "                \"ty\": 247,\n" +
                    "                \"tz\": 0\n" +
                    "            },\n" +
                    "            {\n" +
                    "                \"e\": {\n" +
                    "                    \"_id\": \"0.4784086286398639\",\n" +
                    "                    \"pen\": {\n" +
                    "                        \"_id\": \"0.8767734543163963\",\n" +
                    "                        \"color\": \"#000000\",\n" +
                    "                        \"width\": 10,\n" +
                    "                        \"opacity\": 1,\n" +
                    "                        \"mask\": false,\n" +
                    "                        \"stroke\": false,\n" +
                    "                        \"linecap\": \"butt\"\n" +
                    "                    },\n" +
                    "                    \"points\": null,\n" +
                    "                    \"d\": \"M 159,64.104154 h -24.62533 -24.3149 c -7.6009,0 -13.259012,5.346184 -13.359156,12.910784 -0.120173,9.383298 0,18.776589 0,28.169882 0,0.18986 0,0.37973 0.09013,0.88936 4.005736,-0.20985 8.161696,0 12.017226,-0.73947 5.81836,-1.1192 9.70394,-6.495358 9.71395,-12.391146 v -4.346897 c 0.36052,0 0.63091,-0.109922 0.90129,-0.109922 h 9.34342 c 0.37053,5.615991 0.34049,10.672379 -3.68529,17.307635 0.34049,0 0.63091,0.0799 0.92132,0.0799 3.24466,0 6.51935,0.21984 9.72395,-0.10993 6.8999,-0.71948 11.49649,-6.225547 11.54657,-13.470372 0,-4.596719 0,-9.193434 0,-13.790153 v -1.408994 h 10.22467 a 1.6623848,1.6588159 0 0 1 0.12017,0.419701 c 0,5.795862 0.19027,11.601714 -0.11016,17.387584 -0.54078,10.352604 -8.82266,19.326194 -19.0273,20.985014 a 27.74981,27.690234 0 0 1 -4.17599,0.34975 q -17.9057,0 -35.811388,0 h -1.782553 v 21.59458 a 12.828404,12.800862 0 0 0 12.948571,12.93077 c 11.09593,0 22.18184,0 33.27776,0 h 1.51217 v 10.35261 h -18.42644 a 13.018676,12.990727 0 0 0 5.80833,11.18202 c 3.83551,2.71806 8.25184,1.99857 12.61811,2.13847 v 10.29266 c -6.39918,0.38972 -12.66818,0.0899 -18.44647,-3.85725 v 9.83298 H 115.5076 v -29.57888 c -6.6095,0.23982 -13.08879,0.1299 -18.947187,-3.99715 v 19.1963 H 86.25563 v -1.36903 q 0,-21.76446 0.08011,-43.51893 0,-26.92078 0,-53.831563 c 0,-11.631696 7.52079,-21.044977 18.67679,-23.383308 a 28.330643,28.26982 0 0 1 5.12736,-0.48965 c 3.00432,-0.07994 6.00863,0 9.01294,0 h 1.41203 A 12.758303,12.730912 0 0 0 115.55767,44.638 12.628116,12.601005 0 0 0 107.54616,41.909947 c -15.622403,0 -31.24481,-0.08993 -46.867225,0 -5.007183,0 -9.834107,-0.48965 -14.230414,-2.99786 A 23.203287,23.153472 0 0 1 34.491367,20.455313 c 0,-0.359744 0,-0.719487 -0.05007,-1.07923 V 18.566661 H 44.83621 c 0.140201,0.909351 0.23033,1.818701 0.420603,2.708067 a 13.018676,12.990727 0 0 0 13.188921,10.202717 9.5036338,9.4832305 0 0 0 5.317628,-2.308353 11.937125,11.911497 0 0 0 5.057255,-9.393294 c 0.140202,-6.625271 0,-13.2605346 0,-19.895798 h 10.33483 v 18.986447 a 23.183258,23.133486 0 0 1 -3.124483,11.78159 8.6323839,8.6138511 0 0 0 -0.410589,0.889365 c 4.145948,0 8.161704,0.129907 12.157436,0 A 12.838418,12.810855 0 0 0 100.44598,19.625905 c 0.25036,-3.267668 0,-6.555321 0.0601,-9.8329814 V 8.3939223 h 10.42496 a 3.71533,3.7073536 0 0 1 0.0901,0.6195577 c 0,3.317632 0.0601,6.635264 0,9.992867 a 23.033043,22.983593 0 0 1 -3.46498,11.801575 5.8584044,5.845827 0 0 0 -0.31045,0.769451 23.033043,22.983593 0 0 1 16.49369,6.295506 23.463661,23.413287 0 0 1 7.4607,15.988587 23.754077,23.70308 0 0 0 3.08442,-0.289793 13.018676,12.990727 0 0 0 10.01437,-12.840834 c 0,-1.998573 0,-3.997147 0,-5.99572 h 10.08447 c 0,3.327625 0.19027,6.565314 -0.0501,9.773024 a 21.110285,21.064963 0 0 1 -3.42492,9.193437 h 8.0115 Z M 23.794135,194.88 a 102.72737,102.50683 0 0 1 0.55079,-10.99215 c 0.360517,-2.45825 1.672399,-4.78659 2.573692,-7.1549 a 11.075889,11.052111 0 0 1 0.620891,-1.13918 H 19.528015 V 165.1812 h 1.281839 27.158962 c 6.309051,0 12.307656,-5.72591 12.347714,-12.0514 0.09013,-11.99144 0,-24.06282 0,-36.09423 0,-0.14989 0,-0.29979 -0.06009,-0.58958 H 24.334911 A 23.353503,23.303365 0 0 1 0.92132172,93.162599 V 88.755745 H 11.416378 c 0,1.688795 -0.120173,3.357603 0,4.996434 0.600862,7.374721 6.00862,12.261261 13.379194,12.261261 H 33.6683 C 30.073143,100.62727 29.312051,94.851394 29.852827,88.73576 h 10.284754 c 0,1.448965 0,2.907924 0,4.366882 a 12.437843,12.41114 0 0 0 2.693865,7.894358 12.01724,11.99144 0 0 0 8.862714,4.90651 c 2.824051,0.18987 5.668131,0 8.672441,0 v -1.18915 c 0,-4.39687 0,-8.793729 0,-13.190591 A 12.918533,12.890798 0 0 0 47.207724,78.393142 H 1.3018676 C 0.87124989,78.393142 0.43061776,78.463093 0,78.503064 V 68.010554 H 18.41642 C 18.997253,62.214691 14.31053,56.129035 8.2418236,55.119756 A 59.295064,59.167764 0 0 0 0,54.81997 V 44.267503 l 6.5894532,0.189864 a 22.732612,22.683807 0 0 1 11.1359758,3.327625 c 0.23033,0.129907 0.480689,0.219843 0.901293,0.4197 V 38.461647 H 29.01162 v 29.588878 h 1.512169 c 6.00862,0 11.937125,0 17.895673,0.05996 a 22.251922,22.20415 0 0 1 11.456435,3.517489 2.8040226,2.7980027 0 0 0 0.430618,0.189864 c 0,0 0.0701,0 0.230331,-0.08994 V 52.971289 H 70.751499 V 187.5952 h -10.18461 v -15.98859 c -0.370532,0.16988 -0.620891,0.25982 -0.841207,0.38973 a 23.033043,22.983593 0 0 1 -12.17747,3.48751 13.018676,12.990727 0 0 0 -13.409237,13.52034 c 0,1.99858 0,3.91721 0,5.87581 Z\"\n" +
                    "                },\n" +
                    "                \"_id\": \"0.40955337122986735\",\n" +
                    "                \"tx\": 516,\n" +
                    "                \"ty\": 228,\n" +
                    "                \"tz\": 0\n" +
                    "            },\n" +
                    "            {\n" +
                    "                \"e\": {\n" +
                    "                    \"_id\": \"0.3716562629962168\",\n" +
                    "                    \"pen\": {\n" +
                    "                        \"_id\": \"0.8767734543163963\",\n" +
                    "                        \"color\": \"#000000\",\n" +
                    "                        \"width\": 10,\n" +
                    "                        \"opacity\": 1,\n" +
                    "                        \"mask\": false,\n" +
                    "                        \"stroke\": false,\n" +
                    "                        \"linecap\": \"butt\"\n" +
                    "                    },\n" +
                    "                    \"points\": null,\n" +
                    "                    \"d\": \"M0,160.34V0H93.64c2.67,7.69,2.82,20.63.32,34H87.37c-14.62,0-29.25.08-43.87-.06-3.16,0-4.49.7-4.37,4.14.24,6.74.19,13.5,0,20.24-.08,3.06.82,4.15,4,4.1,11.87-.17,23.75,0,35.62-.13,2.95,0,3.86.79,4.39,3.86a78.74,78.74,0,0,1,0,26.81c-.5,3-1.56,3.67-4.27,3.65-11.62-.1-23.25.08-34.87-.12-3.68-.07-5,.85-4.91,4.77.21,18.12,0,36.24.15,54.36,0,3.38-.51,4.8-4.49,5.29A133.14,133.14,0,0,1,0,160.34Z M155,163.51c-11.32-.32-22.14-2.33-32-8.14-14-8.26-21.14-21.16-24.09-36.62a80.3,80.3,0,0,1,2.52-41.37q9.87-29.15,40.29-34.68c13.08-2.38,25.88-1.64,38.27,3.19C195.84,52,205.34,64,209.78,80.06c4.67,16.91,4.62,33.85-1.67,50.34-7,18.41-20.83,28.67-40.13,31.71C163.68,162.79,159.32,163.05,155,163.51Zm-20.24-62c1.1,6.79,1.64,12.39,3,17.8,1.94,8,7.82,13.16,14.57,13.68,9.72.75,16-2.28,19.3-10.77,5.1-13.06,5.18-26.39-.5-39.37-3-6.86-8.7-10-16.19-9.92S141.79,76.11,139.31,83C137.08,89.26,136.07,95.94,134.75,101.5Z M270,160.29a107.76,107.76,0,0,1-37,.06c-.06-1.27-.16-2.48-.16-3.7,0-35.85,0-71.71-.08-107.56,0-3.41.69-4.8,4.38-5,14.2-.71,28.37-2.32,42.57-2.48,12.14-.14,24.15,1.81,34.77,8.59,12.56,8,16.67,20,15.67,34.13-.7,10-4.46,18.64-12.26,25.2-1.94,1.63-1,3-.23,4.56q11,21.28,21.95,42.56c.55,1.07,1,2.19,1.74,3.78a138,138,0,0,1-39.49.14,5,5,0,0,1-3.21-2.52c-7.57-16-15-32.09-22.5-48.11-1-2.17-.56-3.26,1.52-4.44,4.69-2.66,9-5.78,11.65-10.76a20.85,20.85,0,0,0,1.77-13.84c-.9-5-5.17-8.41-11-9.26C271,70.3,270,71.08,270,80.24 M447.27,156.17c-21.86,7.1-43.79,10.33-66.15,3-15.09-4.93-25.5-15-30.49-30.1-6.76-20.39-6.27-40.66,3.66-60,7.73-15,20.51-23.61,37.21-26.55,12.26-2.16,24.12-1.5,35.43,4,14.74,7.15,22.52,19.52,25.83,35.12,2.16,10.17,1.7,20.36,0,30.52-.16.93-1.48,1.9-2.49,2.39-.81.39-2,.09-3,.09H389.21c-1.47,0-2.94.12-4.43.19.65,7.09,5.65,13.67,12.9,15A77.75,77.75,0,0,0,418.4,131c6.36-.55,12.57-2.93,18.81-4.59,1.74-.46,2.88-.59,3.9,1.41C444.84,135.12,447.79,147.84,447.27,156.17Zm-27.7-67.49c.73-7.18-3.45-14.5-9.48-17.07-10-4.28-23.24.5-25.87,13.11-.64,3.08-.14,4.05,3,4,8.22-.12,16.44,0,24.67,0Z M504.1,163.93a136.42,136.42,0,0,1-35-6.42c-2.16-.69-3.59-1.68-2.91-4.23,2.26-8.54,4.49-17.09,6.8-25.62.66-2.41,2.38-2.07,4.17-1.31,10.92,4.66,22.35,6,34.08,5.1a17.1,17.1,0,0,0,6.71-2.07c4.21-2.33,4.15-7.2-.28-9a167.07,167.07,0,0,0-17.42-5.55c-9.27-2.57-18.1-6-24.62-13.39C465.26,89.7,466,68.7,477,56.64c9.86-10.83,22.79-14.4,36.71-15.11,13-.66,25.55,2.12,38,5.62,2.64.74,4.13,1.8,3.17,5-2.3,7.6-4.42,15.26-6.52,22.92-.76,2.77-2.3,2.6-4.53,1.84-9.13-3.09-18.39-5.66-28.15-5.31a14.11,14.11,0,0,0-6.12,1.3c-1.52.83-3.3,2.74-3.36,4.24a5.9,5.9,0,0,0,2.95,4.53c4,1.74,8.25,2.75,12.4,4.06,6.29,2,12.77,3.52,18.81,6.09,12.05,5.12,17.5,14.87,18.23,27.72,1.36,23.74-14.19,36.34-32.4,41C519,162.36,511.48,162.83,504.1,163.93Z M672.94,75.81c-9.5,0-19.1.14-28.69-.08-3.43-.08-4.44.94-4.42,4.38.13,25.48.07,51,.07,76.44,0,1.22,0,2.44,0,4-6.43.45-12.49,1.2-18.55,1.22s-12.14-.68-18.46-1.07c-.07-1.44-.18-2.52-.18-3.6q0-37.84,0-75.69c0-5.62,0-5.62-5.79-5.62-8.24,0-16.49-.1-24.73.07-2.42.05-3.71-.88-3.74-3-.11-8.58-.09-17.16,0-25.74,0-1.73.88-2.84,3.07-2.83q50.4.13,100.79.11a2.49,2.49,0,0,1,.71.22C675.47,51.27,675.48,68.44,672.94,75.81Z\"\n" +
                    "                },\n" +
                    "                \"_id\": \"0.5971060556733905\",\n" +
                    "                \"tx\": 197,\n" +
                    "                \"ty\": 436,\n" +
                    "                \"tz\": 0\n" +
                    "            }\n" +
                    "        ],\n" +
                    "        \"children\": [],\n" +
                    "        \"imageCount\": 0,\n" +
                    "        \"ftz\": 0,\n" +
                    "        \"keptImage\": 0,\n" +
                    "        \"player\": {\n" +
                    "            \"playing\": false,\n" +
                    "            \"startMoment\": null\n" +
                    "        },\n" +
                    "        \"config\": {\n" +
                    "            \"showPhantom\": true,\n" +
                    "            \"imageDuration\": 15,\n" +
                    "            \"durationCoef\": 1,\n" +
                    "            \"activeModeIdx\": 0,\n" +
                    "            \"activeMaskIdx\": 0,\n" +
                    "            \"smooth\": true,\n" +
                    "            \"smoothing\": 0.2,\n" +
                    "            \"flattening\": 0,\n" +
                    "            \"simplify\": false,\n" +
                    "            \"simpleMode\": \"visvalingam\",\n" +
                    "            \"simpleCoef\": 10\n" +
                    "        },\n" +
                    "        \"selection\": {\n" +
                    "            \"elementId\": null,\n" +
                    "            \"box\": null\n" +
                    "        },\n" +
                    "        \"zoom\": 1\n" +
                    "    },\n" +
                    "    \"_id\": \"0.3490873212240104\",\n" +
                    "    \"tx\": 0,\n" +
                    "    \"ty\": 0,\n" +
                    "    \"tz\": 0\n" +
                    "}"
                }
            },
    }
</script>